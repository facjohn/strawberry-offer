<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“ ë”¸ê¸° ì˜¤í¼ ê³„ì‚°ê¸°</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#f4f5f7; --surface:#ffffff; --surface2:#f0f1f4; --border:#dde0e8;
    --red:#e8334a; --green:#18a96a; --yellow:#d48a00; --blue:#3b6ff0; --sgd:#c47d00;
    --text:#1a1a2e; --text2:#606080; --text3:#a0a0b8; --accent:#e8334a;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;min-height:100vh;}

  /* â”€â”€ HEADER â”€â”€ */
  .header{
    background:linear-gradient(135deg,#fff0f2,#ffffff);
    border-bottom:1px solid var(--border);
    padding:12px 18px;display:flex;align-items:center;gap:10px;
    position:sticky;top:0;z-index:100;
  }
  .header h1{font-size:15px;font-weight:700;}
  .header-sub{font-size:10px;color:var(--text2);font-family:'JetBrains Mono',monospace;margin-top:1px;}
  .header-right{margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:3px;}
  .sync-badge{
    font-size:9px;font-weight:700;padding:3px 8px;border-radius:20px;border:1px solid;
    font-family:'JetBrains Mono',monospace;cursor:pointer;transition:all .2s;white-space:nowrap;
  }
  .sync-badge.ok{color:var(--green);border-color:var(--green);}
  .sync-badge.error{color:var(--red);border-color:var(--red);}
  .sync-badge.idle{color:var(--text2);border-color:var(--border);}
  .sync-badge.loading{color:var(--yellow);border-color:var(--yellow);animation:blink .8s infinite;}
  @keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
  .last-sync{font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace;}

  /* â”€â”€ BASE INPUTS â”€â”€ */
  .base-section{
    padding:12px 18px;background:var(--surface);border-bottom:1px solid var(--border);
    display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
  }
  .input-group label{font-size:10px;font-weight:700;color:var(--text2);display:block;margin-bottom:5px;}
  .input-group label em{color:var(--accent);font-style:normal;}
  .input-group label .sg{color:var(--sgd);}
  .input-group input{
    width:100%;background:var(--bg);border:1px solid var(--border);
    color:var(--text);font-family:'JetBrains Mono',monospace;
    font-size:13px;font-weight:600;padding:7px 8px;border-radius:6px;outline:none;transition:border-color .15s;
  }
  .input-group input:focus{border-color:var(--accent);}
  .input-group input.updated{border-color:var(--green);animation:flashGreen .6s ease-out;}
  @keyframes flashGreen{0%{background:rgba(24,169,106,.15)}100%{background:var(--bg)}}
  .sgd-hint{font-size:9px;color:var(--sgd);margin-top:3px;display:flex;align-items:center;gap:4px;}
  .dot{width:5px;height:5px;border-radius:50%;background:var(--sgd);animation:pulse 2s infinite;flex-shrink:0;}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

  /* â”€â”€ TABS â”€â”€ */
  .tabs{display:flex;background:var(--surface);border-bottom:1px solid var(--border);padding:0 18px;overflow-x:auto;}
  .tab-btn{
    padding:9px 12px;font-size:12px;font-weight:600;color:var(--text2);
    border:none;background:none;border-bottom:2px solid transparent;
    cursor:pointer;transition:all .15s;font-family:'Noto Sans KR',sans-serif;white-space:nowrap;
  }
  .tab-btn.active{color:var(--text);border-bottom-color:var(--accent);}
  .log-count{
    display:inline-block;background:var(--accent);color:#fff;
    font-size:8px;font-weight:700;padding:1px 5px;border-radius:10px;margin-left:4px;
    vertical-align:middle;
  }

  /* â”€â”€ PANELS â”€â”€ */
  .tab-panel{display:none;padding:14px 18px;flex-direction:column;gap:12px;}
  .tab-panel.active{display:flex;}

  /* â”€â”€ COUNTRY CARD â”€â”€ */
  .country-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
  .country-header{
    padding:9px 14px;background:var(--surface2);border-bottom:1px solid var(--border);
    display:flex;align-items:center;gap:8px;
  }
  .country-flag{font-size:17px;}
  .country-name{font-size:13px;font-weight:700;}
  .country-currency{margin-left:auto;font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;}
  .cur-usd{background:rgba(59,111,240,.1);color:var(--blue);}
  .cur-sgd{background:rgba(196,125,0,.1);color:var(--sgd);}

  /* â”€â”€ SPEC ROW â”€â”€ */
  .spec-row{
    display:grid;
    grid-template-columns:1fr 78px 1fr 36px;
    gap:6px;align-items:center;padding:9px 14px;border-bottom:1px solid var(--border);
  }
  .spec-row:last-of-type{border-bottom:none;}
  .spec-label{font-size:12px;color:var(--text);font-weight:700;}
  .spec-badge{display:inline-block;font-size:8px;font-weight:700;padding:1px 4px;border-radius:3px;margin-left:3px;vertical-align:middle;}
  .badge-250{background:rgba(232,51,74,.12);color:var(--red);}
  .badge-500{background:rgba(180,120,0,.12);color:var(--yellow);}
  .badge-330{background:rgba(59,111,240,.12);color:var(--blue);}
  .cost-detail{font-size:9px;color:var(--text3);font-family:'JetBrains Mono',monospace;margin-top:2px;}

  .price-input-wrap{display:flex;align-items:center;gap:3px;}
  .price-prefix{font-size:10px;color:var(--text2);min-width:14px;}
  .price-input{
    width:60px;background:var(--bg);border:1px solid var(--border);
    color:var(--text);font-family:'JetBrains Mono',monospace;
    font-size:13px;font-weight:600;padding:5px;border-radius:5px;
    outline:none;text-align:center;transition:border-color .15s;
  }
  .price-input:focus{border-color:var(--accent);}

  .margin-display{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:auto auto;gap:1px 6px;text-align:right;}
  .m-box-val{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;grid-column:1;grid-row:1;}
  .m-pct{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;grid-column:2;grid-row:1;color:var(--text2);}
  .m-krw-total{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;grid-column:1/span 2;grid-row:2;}
  .mpos{color:var(--green);}
  .mmid{color:var(--yellow);}
  .mneg{color:var(--red);}

  /* â”€â”€ ê¸°ë¡ ë²„íŠ¼ â”€â”€ */
  .log-btn{
    width:32px;height:32px;border-radius:6px;
    background:rgba(59,111,240,.08);border:1px solid rgba(59,111,240,.25);
    color:var(--blue);font-size:14px;cursor:pointer;
    display:flex;align-items:center;justify-content:center;
    transition:all .15s;flex-shrink:0;
  }
  .log-btn:hover{background:rgba(59,111,240,.15);border-color:var(--blue);}
  .log-btn:active{transform:scale(.92);}
  .log-btn.logged{
    background:rgba(24,169,106,.15);border-color:rgba(24,169,106,.4);
    color:var(--green);animation:logPop .3s ease-out;
  }
  @keyframes logPop{0%{transform:scale(1.3)}100%{transform:scale(1)}}

  /* â”€â”€ ì˜¤í¼ ê¸°ë¡ íƒ­ â”€â”€ */
  .log-toolbar{
    display:flex;align-items:center;gap:8px;
  }
  .log-toolbar-title{font-size:13px;font-weight:700;flex:1;}
  .log-filter{
    background:var(--bg);border:1px solid var(--border);
    color:var(--text);font-family:'Noto Sans KR',sans-serif;
    font-size:11px;padding:5px 8px;border-radius:6px;outline:none;
  }
  .clear-btn{
    background:none;border:1px solid var(--border);
    color:var(--text3);font-size:11px;padding:5px 10px;
    border-radius:6px;cursor:pointer;transition:all .15s;
    font-family:'Noto Sans KR',sans-serif;
  }
  .clear-btn:hover{border-color:var(--red);color:var(--red);}

  .log-empty{
    text-align:center;padding:40px 20px;color:var(--text3);
    font-size:13px;line-height:2;
  }
  .log-empty .emoji{font-size:36px;display:block;margin-bottom:8px;}

  .log-item{
    background:var(--surface);border:1px solid var(--border);
    border-radius:10px;padding:12px 14px;position:relative;
    transition:border-color .15s;
  }
  .log-item:hover{border-color:rgba(91,143,255,.3);}
  .log-top{display:flex;align-items:flex-start;gap:10px;margin-bottom:8px;}
  .log-flag{font-size:20px;flex-shrink:0;}
  .log-main{flex:1;}
  .log-country{font-size:13px;font-weight:700;}
  .log-spec-badge{
    display:inline-block;font-size:9px;font-weight:700;
    padding:1px 5px;border-radius:3px;margin-left:5px;vertical-align:middle;
  }
  .log-date{font-size:10px;color:var(--text3);font-family:'JetBrains Mono',monospace;margin-top:2px;}
  .log-memo-text{font-size:11px;color:var(--text2);margin-top:3px;font-style:italic;}

  .log-prices{
    display:grid;grid-template-columns:repeat(4,1fr);gap:6px;
    background:var(--surface2);border-radius:7px;padding:8px 10px;
  }
  .log-price-item label{font-size:9px;color:var(--text3);display:block;margin-bottom:2px;}
  .log-price-item .val{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:600;}

  .log-actions{display:flex;gap:6px;margin-top:8px;}
  .log-action-btn{
    background:none;border:1px solid var(--border);
    color:var(--text2);font-size:10px;padding:4px 8px;
    border-radius:5px;cursor:pointer;transition:all .15s;
    font-family:'Noto Sans KR',sans-serif;
  }
  .log-action-btn:hover{border-color:var(--blue);color:var(--blue);}
  .log-action-btn.del:hover{border-color:var(--red);color:var(--red);}

  /* ë©”ëª¨ ì…ë ¥ */
  .memo-input{
    width:100%;background:var(--bg);border:1px solid var(--border);
    color:var(--text);font-family:'Noto Sans KR',sans-serif;
    font-size:11px;padding:6px 8px;border-radius:6px;outline:none;
    margin-top:6px;transition:border-color .15s;resize:none;
  }
  .memo-input:focus{border-color:var(--blue);}

  /* ê¸°ë¡ ëª¨ë‹¬ */
  .modal-overlay{
    position:fixed;inset:0;background:rgba(0,0,0,.7);
    display:flex;align-items:center;justify-content:center;
    z-index:200;padding:20px;
  }
  .modal-overlay.hidden{display:none;}
  .modal{
    background:var(--surface);border:1px solid var(--border);
    border-radius:14px;padding:20px;width:100%;max-width:360px;
    box-shadow:0 8px 32px rgba(0,0,0,.12);
  }
  .modal h3{font-size:14px;font-weight:700;margin-bottom:4px;}
  .modal .modal-sub{font-size:11px;color:var(--text2);margin-bottom:14px;}
  .modal-info{
    background:var(--surface2);border-radius:8px;padding:10px;
    font-size:11px;margin-bottom:12px;line-height:1.8;
  }
  .modal-info span{color:var(--text);font-weight:600;font-family:'JetBrains Mono',monospace;}
  .modal label{font-size:10px;color:var(--text2);font-weight:700;display:block;margin-bottom:5px;}
  .modal textarea{
    width:100%;background:var(--bg);border:1px solid var(--border);
    color:var(--text);font-family:'Noto Sans KR',sans-serif;
    font-size:12px;padding:8px;border-radius:6px;outline:none;
    resize:none;height:70px;transition:border-color .15s;
  }
  .modal textarea:focus{border-color:var(--blue);}
  .modal-btns{display:flex;gap:8px;margin-top:12px;}
  .modal-btn{
    flex:1;padding:10px;border-radius:7px;font-size:13px;font-weight:700;
    cursor:pointer;transition:all .15s;border:1px solid;
    font-family:'Noto Sans KR',sans-serif;
  }
  .modal-btn.cancel{background:none;border-color:var(--border);color:var(--text2);}
  .modal-btn.confirm{background:rgba(24,169,106,.12);border-color:var(--green);color:var(--green);}
  .modal-btn.confirm:hover{background:rgba(24,169,106,.22);}

  /* â”€â”€ SETTINGS â”€â”€ */
  .settings-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px;}
  .settings-card p{font-size:11px;color:var(--text2);line-height:1.6;margin-bottom:8px;}
  .settings-card code{
    display:block;background:var(--bg);border:1px solid var(--border);
    border-radius:6px;padding:10px;font-size:10px;color:#99ccff;
    font-family:'JetBrains Mono',monospace;white-space:pre;overflow-x:auto;
    margin:8px 0;line-height:1.5;
  }
  .url-row{display:flex;gap:8px;margin-top:8px;}
  .url-input{
    flex:1;background:var(--bg);border:1px solid var(--border);
    color:var(--text);font-family:'JetBrains Mono',monospace;
    font-size:11px;padding:7px 10px;border-radius:6px;outline:none;transition:border-color .15s;
  }
  .url-input:focus{border-color:var(--blue);}
  .btn{
    background:var(--surface2);border:1px solid var(--border);
    color:var(--text2);font-family:'Noto Sans KR',sans-serif;
    font-size:11px;font-weight:600;padding:7px 12px;
    border-radius:6px;cursor:pointer;transition:all .15s;white-space:nowrap;
  }
  .btn.primary{border-color:var(--green);color:var(--green);}
  .btn.primary:hover{background:rgba(46,204,138,.1);}
  .sync-result{font-size:10px;margin-top:6px;font-family:'JetBrains Mono',monospace;padding:6px 8px;border-radius:5px;}
  .sync-result.ok{background:rgba(24,169,106,.08);color:var(--green);border:1px solid rgba(24,169,106,.2);}
  .sync-result.error{background:rgba(232,51,74,.06);color:var(--red);border:1px solid rgba(232,51,74,.2);}
  .auto-banner{
    background:rgba(24,169,106,.07);border:1px solid rgba(24,169,106,.25);
    border-radius:8px;padding:10px 14px;font-size:11px;color:var(--green);
    display:flex;align-items:center;gap:8px;
  }
  .dot-green{width:6px;height:6px;border-radius:50%;background:var(--green);flex-shrink:0;animation:pulse 2s infinite;}

  /* FREIGHT EDITOR */
  .freight-editor{display:flex;flex-direction:column;gap:10px;}
  .freight-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;}
  .freight-card-header{padding:8px 14px;background:var(--surface2);border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px;font-size:12px;font-weight:700;}
  .freight-fields{padding:10px 14px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}
  .freight-field label{font-size:9px;color:var(--text2);font-weight:700;display:block;margin-bottom:4px;}
  .freight-field input{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:600;padding:6px 7px;border-radius:5px;outline:none;transition:border-color .15s;}
  .freight-field input:focus{border-color:var(--blue);}
  .save-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text2);font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:600;padding:10px;border-radius:7px;cursor:pointer;transition:all .15s;width:100%;}
  .save-btn:hover{border-color:var(--green);color:var(--green);}
  .save-btn.saved{border-color:var(--green);color:var(--green);}


  /* â”€â”€ ë¹„ë°€ë²ˆí˜¸ í™”ë©´ â”€â”€ */
  .pw-overlay{
    position:fixed;inset:0;background:#fff;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    z-index:9999;padding:30px;
  }
  .pw-overlay.hidden{display:none;}
  .pw-box{
    background:#fff;border:1px solid var(--border);
    border-radius:16px;padding:32px 28px;width:100%;max-width:320px;
    text-align:center;box-shadow:0 8px 32px rgba(0,0,0,.08);
  }
  .pw-emoji{font-size:48px;margin-bottom:12px;}
  .pw-title{font-size:18px;font-weight:900;color:var(--text);margin-bottom:4px;}
  .pw-sub{font-size:12px;color:var(--text2);margin-bottom:24px;}
  .pw-input{
    width:100%;background:var(--bg);border:2px solid var(--border);
    color:var(--text);font-family:'JetBrains Mono',monospace;
    font-size:24px;font-weight:700;padding:12px;border-radius:10px;
    outline:none;text-align:center;letter-spacing:8px;
    transition:border-color .15s;margin-bottom:12px;
  }
  .pw-input:focus{border-color:var(--accent);}
  .pw-input.shake{animation:shake .3s ease-out;}
  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
  .pw-btn{
    width:100%;padding:13px;border-radius:10px;
    background:var(--accent);border:none;color:#fff;
    font-size:15px;font-weight:700;cursor:pointer;
    font-family:'Noto Sans KR',sans-serif;transition:opacity .15s;
  }
  .pw-btn:hover{opacity:.9;}
  .pw-error{font-size:12px;color:var(--red);margin-top:8px;height:16px;}
  ::-webkit-scrollbar{width:4px;}
  ::-webkit-scrollbar-track{background:var(--bg);}
  ::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
</style>
</head>
<body>

<!-- HEADER -->

<div class="pw-overlay" id="pw-overlay">
  <div class="pw-box">
    <div class="pw-emoji">ğŸ“</div>
    <div class="pw-title">ë”¸ê¸° ì˜¤í¼ ê³„ì‚°ê¸°</div>
    <div class="pw-sub">í˜„ë† í”„ë ˆì‰¬ by JOHN</div>
    <input class="pw-input" type="password" id="pw-input"
      placeholder="****" maxlength="10"
      onkeydown="if(event.key==='Enter')checkPw()">
    <button class="pw-btn" onclick="checkPw()">ì…ì¥</button>
    <div class="pw-error" id="pw-error"></div>
  </div>
</div>

<div class="header">
  <span style="font-size:22px">ğŸ“</span>
  <div>
    <h1>ë”¸ê¸° ì˜¤í¼ ê³„ì‚°ê¸°</h1>
    <div class="header-sub">í˜„ë† í”„ë ˆì‰¬ by JOHN</div>
  </div>
  <div class="header-right">
    <div class="sync-badge idle" id="sync-badge" onclick="syncFromSheets()">ğŸ”„ ìˆ˜ë™ ë™ê¸°í™”</div>
    <div class="last-sync" id="last-sync">ë§ˆì§€ë§‰ ë™ê¸°í™”: -</div>
  </div>
</div>

<!-- BASE INPUTS -->
<div class="base-section">
  <div class="input-group">
    <label>ë‹¨ê°€ <em>250g</em></label>
    <input type="number" id="price250" value="11500" oninput="recalcAll()">
  </div>
  <div class="input-group">
    <label>ë‹¨ê°€ <em>500g/330g</em></label>
    <input type="number" id="price500" value="13000" oninput="recalcAll()">
  </div>
  <div class="input-group">
    <label>í™˜ìœ¨ â‚©/$</label>
    <input type="number" id="exrate" value="1400" oninput="recalcAll()">
  </div>
  <div class="input-group">
    <label><span class="sg">SGD</span>/â‚© (ë¸Œë£¨ë‚˜ì´)</label>
    <input type="number" id="sgdrate" value="1137" oninput="recalcAll()">
    <div class="sgd-hint"><span class="dot"></span>ì‹œíŠ¸ ìë™ ë°˜ì˜</div>
  </div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab-btn active" onclick="switchTab('offers',this)">ğŸ“Š ì˜¤í¼ ê³„ì‚°</button>
  <button class="tab-btn" onclick="switchTab('logs',this)">ğŸ“‹ ì˜¤í¼ ê¸°ë¡<span class="log-count" id="log-count">0</span></button>
  <button class="tab-btn" onclick="switchTab('freight',this)">âœï¸ ìš´ì„ í¸ì§‘</button>
  <button class="tab-btn" onclick="switchTab('settings',this)">âš™ï¸ ì‹œíŠ¸ ì—°ë™</button>
  <button class="tab-btn" onclick="switchTab('memo',this)">ğŸ“ ë©”ëª¨</button>
</div>

<!-- TAB: ì˜¤í¼ ê³„ì‚° -->
<div id="tab-offers" class="tab-panel active"></div>

<!-- TAB: ì˜¤í¼ ê¸°ë¡ -->
<div id="tab-logs" class="tab-panel">
  <div class="log-toolbar">
    <div class="log-toolbar-title">ì˜¤í¼ ê¸°ë¡</div>
    <select class="log-filter" id="log-filter" onchange="renderLogs()">
      <option value="">ì „ì²´ ë‚˜ë¼</option>
    </select>
    <button class="clear-btn" onclick="clearAllLogs()">ì „ì²´ ì‚­ì œ</button>
  </div>
  <div id="log-list"></div>
</div>

<!-- TAB: ìš´ì„ í¸ì§‘ -->
<div id="tab-freight" class="tab-panel">
  <p style="font-size:11px;color:var(--text2)">ìš´ì„ì€ ì•± ì‹¤í–‰ ì‹œ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤. ìˆ˜ë™ ìˆ˜ì • í›„ ì €ì¥í•˜ì„¸ìš”.</p>
  <div class="freight-editor" id="freight-editor"></div>
  <button class="save-btn" id="save-btn" onclick="saveFreight()">ğŸ’¾ ìš´ì„ ì €ì¥ (ë¸Œë¼ìš°ì €ì— ê¸°ì–µ)</button>
</div>

<!-- TAB: ì‹œíŠ¸ ì—°ë™ -->
<div id="tab-settings" class="tab-panel">
  <div class="auto-banner">
    <span class="dot-green"></span>
    <span>ì•±ì„ ì—´ ë•Œë§ˆë‹¤ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìë™ìœ¼ë¡œ ìµœì‹  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.</span>
  </div>
  <div class="settings-card">
    <p><strong style="color:var(--text)">Apps Script URL ì„¤ì •</strong><br>
    URLì„ ì €ì¥í•˜ë©´ ë‹¤ìŒë¶€í„° ì•±ì„ ì—´ ë•Œë§ˆë‹¤ ìë™ ë™ê¸°í™”ë©ë‹ˆë‹¤.</p>
    <div class="url-row">
      <input class="url-input" type="text" id="sheets-url" placeholder="https://script.google.com/macros/s/AKfy.../exec">
      <button class="btn primary" onclick="saveUrlAndSync()">ì €ì¥ + ì§€ê¸ˆ ë™ê¸°í™”</button>
    </div>
    <div id="sync-result" style="display:none"></div>
  </div>
  <div class="settings-card">
    <p><strong style="color:var(--text)">ë™ê¸°í™” í•­ëª©:</strong> ë”¸ê¸°ë‹¨ê°€, í™˜ìœ¨, SGDí™˜ìœ¨, ë‚˜ë¼ë³„ ìš´ì„+FSC</p>
    <p style="margin-top:8px;color:var(--text3)">Apps Script ì½”ë“œ (í•œ ë²ˆë§Œ ì„¤ì •):</p>
    <code>function doGet() {
  const ss    = SpreadsheetApp.getActiveSpreadsheet();
  const straw = ss.getSheetByName("ë”¸ê¸°");
  const data  = ss.getSheetByName("DATA");
  const result = {
    prices: {
      p500_330: straw.getRange("C2").getValue(),
      p250:     straw.getRange("C3").getValue(),
    },
    exrate:  straw.getRange("C1").getValue(),
    sgdrate: straw.getRange("C36").getValue(),
    freight: {
      vn_hcm: { airKg: data.getRange("K25").getValue(), fsc: data.getRange("L25").getValue() },
      vn_han: { airKg: data.getRange("K24").getValue(), fsc: data.getRange("L24").getValue() },
      th:     { airKg: data.getRange("K35").getValue(), fsc: data.getRange("L35").getValue() },
      id:     { airKg: data.getRange("K29").getValue(), fsc: data.getRange("L29").getValue() },
      my:     { airKg: data.getRange("K27").getValue(), fsc: data.getRange("L27").getValue() },
      hk:     { airKg: data.getRange("K30").getValue(), fsc: data.getRange("L30").getValue() },
      ph:     { airKg: data.getRange("K37").getValue(), fsc: data.getRange("L37").getValue() },
      bn:     { airKg: data.getRange("K31").getValue(), fsc: data.getRange("L31").getValue() },
    }
  };
  return ContentService
    .createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}</code>
  </div>
</div>


<!-- TAB: ë©”ëª¨ -->
<div id="tab-memo" class="tab-panel">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;">
    <span style="font-size:13px;font-weight:700;">ììœ  ë©”ëª¨</span>
    <button onclick="clearMemo()" style="background:none;border:1px solid var(--border);color:var(--text2);font-size:11px;padding:4px 10px;border-radius:6px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;">ì´ˆê¸°í™”</button>
  </div>
  <p style="font-size:11px;color:var(--text2);margin-bottom:8px;">ìë™ ì €ì¥ë©ë‹ˆë‹¤. ë°”ì´ì–´ ì—°ë½ì²˜, í˜‘ì˜ ë‚´ìš©, í•  ì¼ ë“± ììœ ë¡­ê²Œ ë©”ëª¨í•˜ì„¸ìš”.</p>
  <textarea id="free-memo"
    style="width:100%;min-height:400px;background:var(--surface);border:1px solid var(--border);
    color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;line-height:1.8;
    padding:14px;border-radius:10px;outline:none;resize:vertical;transition:border-color .15s;"
    placeholder="ììœ ë¡­ê²Œ ë©”ëª¨í•˜ì„¸ìš”...&#10;&#10;ì˜ˆ)&#10;- ë² íŠ¸ë‚¨ CPG ë°”ì´ì–´: +84-xxx-xxxx&#10;- íƒœêµ­ 3ì›” ì„ ì  í˜‘ì˜ ì¤‘&#10;- í™ì½© 250g ìƒ˜í”Œ ë°œì†¡ ì™„ë£Œ"
    oninput="saveMemo()"></textarea>
  <div style="text-align:right;font-size:10px;color:var(--text3);margin-top:4px;" id="memo-saved-hint"></div>
</div>

<!-- ê¸°ë¡ ëª¨ë‹¬ -->
<div class="modal-overlay hidden" id="modal-overlay">
  <div class="modal">
    <h3>ğŸ“ ì˜¤í¼ ê¸°ë¡ ì €ì¥</h3>
    <div class="modal-sub" id="modal-sub">ì´ ì˜¤í¼ë¥¼ ê¸°ë¡ì— ì €ì¥í•©ë‹ˆë‹¤</div>
    <div class="modal-info" id="modal-info"></div>
    <label>ë©”ëª¨ (ë°”ì´ì–´, íŠ¹ì´ì‚¬í•­ ë“± ì„ íƒì…ë ¥)</label>
    <textarea id="modal-memo" placeholder="ì˜ˆ) ë°”ì´ì–´, ê¸°íƒ€ì‚¬í•­"></textarea>
    <div class="modal-btns">
      <button class="modal-btn cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="modal-btn confirm" onclick="confirmLog()">âœ… ê¸°ë¡ ì €ì¥</button>
    </div>
  </div>
</div>

<script>
// â”€â”€ ë°ì´í„° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let FREIGHT = {
  vn_hcm:{name:'ë² íŠ¸ë‚¨ í˜¸ì¹˜ë¯¼',flag:'ğŸ‡»ğŸ‡³',route:'SGN',airKg:1900,fsc:410,domFreight:55000},
  vn_han:{name:'ë² íŠ¸ë‚¨ í•˜ë…¸ì´',flag:'ğŸ‡»ğŸ‡³',route:'HAN',airKg:1500,fsc:410,domFreight:55000},
  th:    {name:'íƒœêµ­',         flag:'ğŸ‡¹ğŸ‡­',route:'BKK',airKg:850, fsc:410,domFreight:55000},
  id:    {name:'ì¸ë„ë„¤ì‹œì•„',   flag:'ğŸ‡®ğŸ‡©',route:'CGK',airKg:3200,fsc:410,domFreight:55000},
  my:    {name:'ë§ë ˆì´ì‹œì•„',   flag:'ğŸ‡²ğŸ‡¾',route:'KUL',airKg:2200,fsc:410,domFreight:55000},
  hk:    {name:'í™ì½©',         flag:'ğŸ‡­ğŸ‡°',route:'HKG',airKg:700, fsc:410,domFreight:55000},
  ph:    {name:'í•„ë¦¬í•€',       flag:'ğŸ‡µğŸ‡­',route:'MNL',airKg:2200,fsc:410,domFreight:55000},
  bn:    {name:'ë¸Œë£¨ë‚˜ì´',     flag:'ğŸ‡§ğŸ‡³',route:'BWN',airKg:7700,fsc:0,  domFreight:55000,isSGD:true},
};

const SPECS=[
  {label:'2kg 250gÃ—8',   badge:'250g',cls:'badge-250',cartons:152,gw:2.9,nw:2,   bujajai:240,priceKey:'250'},
  {label:'2kg 500gÃ—4',   badge:'500g',cls:'badge-500',cartons:153,gw:2.8,nw:2,   bujajai:120,priceKey:'500'},
  {label:'1.32kg 330gÃ—4',badge:'330g',cls:'badge-330',cartons:220,gw:2.0,nw:1.32,bujajai:120,priceKey:'500'},
];

const DEFAULT_PRICES={
  vn_hcm:[22.4,null,20.2],vn_han:[24,null,20.2],th:[23.8,null,19],
  id:[24.8,null,18.2],my:[23.5,null,23.4],hk:[19.5,null,14.4],
  ph:[22.5,null,16.4],bn:[38.5,47,27],
};

// â”€â”€ ì˜¤í¼ ê¸°ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let offerLogs = [];
let pendingLog = null;

function loadLogs(){
  try{const d=localStorage.getItem('sb_offer_logs');if(d)offerLogs=JSON.parse(d);}catch(e){}
  updateLogCount();
}

function saveLogs(){
  try{localStorage.setItem('sb_offer_logs',JSON.stringify(offerLogs));}catch(e){}
  updateLogCount();
}

function updateLogCount(){
  const el=document.getElementById('log-count');
  if(el) el.textContent=offerLogs.length;
}

// ê¸°ë¡ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ê¸°
function openLogModal(key, specIdx){
  const p250 =+document.getElementById('price250').value||0;
  const p500 =+document.getElementById('price500').value||0;
  const ex   =+document.getElementById('exrate').value  ||1400;
  const sgd  =+document.getElementById('sgdrate').value ||1137;
  const offer=+document.getElementById(`offer-${key}-${specIdx}`)?.value||0;
  const fd   =FREIGHT[key];
  const spec =SPECS[specIdx];

  const {marginBox,marginPct,totalKrw,cifKrw}=calcMargin(offer,spec,fd,p250,p500,ex,sgd);
  const sym=fd.isSGD?'S$':'$';
  const matPrice=spec.priceKey==='250'?p250:p500;
  const rate=fd.isSGD?sgd:ex;

  pendingLog={
    id: Date.now(),
    date: new Date().toISOString(),
    key, specIdx,
    country: fd.name, flag: fd.flag,
    spec: spec.label, badge: spec.badge, badgeCls: spec.cls,
    offer, sym, isSGD: fd.isSGD,
    price250: p250, price500: p500,
    matPrice, exrate: ex, sgdrate: sgd, rate,
    marginBox, marginPct, totalKrw, cifKrw,
    memo:''
  };

  document.getElementById('modal-sub').textContent=`${fd.flag} ${fd.name} Â· ${spec.label}`;
  document.getElementById('modal-info').innerHTML=`
    ì˜¤í¼ê°€ê²©: <span>${sym}${offer}</span> &nbsp;|&nbsp;
    ë”¸ê¸°ë‹¨ê°€: <span>â‚©${matPrice.toLocaleString()}</span> &nbsp;|&nbsp;
    í™˜ìœ¨: <span>â‚©${rate}</span><br>
    ë°•ìŠ¤ë‹¹ ë§ˆì§„: <span class="${mCls(marginBox)}">${fmt(marginBox)}${sym}</span> &nbsp;|&nbsp;
    ë§ˆì§„ìœ¨: <span class="${mCls(marginBox)}">${fmt(marginPct,1)}%</span><br>
    ì»¨í…Œì´ë„ˆ ì´ë§ˆì§„: <span class="${mCls(totalKrw)}">${fmtKrw(totalKrw)} (${spec.cartons}ë°•ìŠ¤)</span>
  `;
  document.getElementById('modal-memo').value='';
  document.getElementById('modal-overlay').classList.remove('hidden');
  setTimeout(()=>document.getElementById('modal-memo').focus(),100);
}

function closeModal(){
  document.getElementById('modal-overlay').classList.add('hidden');
  pendingLog=null;
}

function confirmLog(){
  if(!pendingLog) return;
  pendingLog.memo=document.getElementById('modal-memo').value.trim();
  offerLogs.unshift(pendingLog); // ìµœì‹ ì´ ë§¨ ìœ„
  saveLogs();

  // ë²„íŠ¼ ì‹œê° í”¼ë“œë°±
  const btn=document.getElementById(`logbtn-${pendingLog.key}-${pendingLog.specIdx}`);
  if(btn){btn.classList.add('logged');setTimeout(()=>btn.classList.remove('logged'),1000);}

  closeModal();
  renderLogs();
  updateFilterOptions();
}

function deleteLog(id){
  offerLogs=offerLogs.filter(l=>l.id!==id);
  saveLogs();
  renderLogs();
  updateFilterOptions();
}

function clearAllLogs(){
  if(!confirm(`ì˜¤í¼ ê¸°ë¡ ${offerLogs.length}ê°œë¥¼ ì „ë¶€ ì‚­ì œí• ê¹Œìš”?`)) return;
  offerLogs=[];
  saveLogs();
  renderLogs();
  updateFilterOptions();
}

function renderLogs(){
  const filter=document.getElementById('log-filter')?.value||'';
  const list=document.getElementById('log-list');
  const filtered=filter?offerLogs.filter(l=>l.key===filter):offerLogs;

  if(filtered.length===0){
    list.innerHTML=`<div class="log-empty"><span class="emoji">ğŸ“‹</span>
      ê¸°ë¡ì´ ì—†ì–´ìš”.<br>ì˜¤í¼ ê³„ì‚° íƒ­ì—ì„œ ğŸ“ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”.</div>`;
    return;
  }

  list.innerHTML=filtered.map(l=>{
    const d=new Date(l.date);
    const dateStr=`${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    const cls=mCls(l.marginBox);
    return `
    <div class="log-item">
      <div class="log-top">
        <span class="log-flag">${l.flag}</span>
        <div class="log-main">
          <div class="log-country">${l.country} <span class="log-spec-badge ${l.badgeCls}">${l.badge}</span></div>
          <div class="log-date">${dateStr}</div>
          ${l.memo?`<div class="log-memo-text">"${l.memo}"</div>`:''}
        </div>
      </div>
      <div class="log-prices">
        <div class="log-price-item"><label>ì˜¤í¼ê°€ê²©</label><div class="val">${l.sym}${l.offer}</div></div>
        <div class="log-price-item"><label>ë”¸ê¸°ë‹¨ê°€</label><div class="val">â‚©${(l.matPrice||0).toLocaleString()}</div></div>
        <div class="log-price-item"><label>í™˜ìœ¨</label><div class="val">â‚©${l.rate}</div></div>
        <div class="log-price-item"><label>ë°•ìŠ¤ë‹¹ë§ˆì§„</label><div class="val ${cls}">${fmt(l.marginBox)}${l.sym}</div></div>
        <div class="log-price-item"><label>ë§ˆì§„ìœ¨</label><div class="val ${cls}">${fmt(l.marginPct,1)}%</div></div>
        <div class="log-price-item" style="grid-column:span 2"><label>ì´ë§ˆì§„ (${SPECS[l.specIdx]?.cartons||'-'}ë°•ìŠ¤)</label><div class="val ${cls}">${fmtKrw(l.totalKrw)}</div></div>
        <div class="log-price-item"><label>ìŠ¤í™</label><div class="val" style="font-size:10px">${l.spec}</div></div>
      </div>
      <div class="log-actions">
        <button class="log-action-btn del" onclick="deleteLog(${l.id})">ğŸ—‘ ì‚­ì œ</button>
      </div>
    </div>`;
  }).join('');
}

function updateFilterOptions(){
  const sel=document.getElementById('log-filter');
  if(!sel)return;
  const cur=sel.value;
  const keys=[...new Set(offerLogs.map(l=>l.key))];
  sel.innerHTML='<option value="">ì „ì²´ ë‚˜ë¼</option>'+
    keys.map(k=>`<option value="${k}" ${k===cur?'selected':''}>${FREIGHT[k]?.flag||''} ${FREIGHT[k]?.name||k}</option>`).join('');
}

// â”€â”€ localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadStorage(){
  try{
    const fr=localStorage.getItem('sb_freight_v2');
    if(fr){const d=JSON.parse(fr);Object.keys(d).forEach(k=>{if(FREIGHT[k])Object.assign(FREIGHT[k],d[k]);});}
    const url=localStorage.getItem('sb_sheets_url');
    if(url) document.getElementById('sheets-url').value=url;
  }catch(e){}
}

function saveFreight(){
  const snap={};
  Object.keys(FREIGHT).forEach(k=>{
    const a=document.getElementById(`fe-air-${k}`);
    const f=document.getElementById(`fe-fsc-${k}`);
    const d=document.getElementById(`fe-dom-${k}`);
    if(a){FREIGHT[k].airKg=+a.value||0;FREIGHT[k].fsc=+f.value||0;FREIGHT[k].domFreight=+d.value||55000;}
    snap[k]={airKg:FREIGHT[k].airKg,fsc:FREIGHT[k].fsc,domFreight:FREIGHT[k].domFreight};
  });
  try{localStorage.setItem('sb_freight_v2',JSON.stringify(snap));}catch(e){}
  const btn=document.getElementById('save-btn');
  btn.textContent='âœ… ì €ì¥ ì™„ë£Œ!';btn.classList.add('saved');
  setTimeout(()=>{btn.textContent='ğŸ’¾ ìš´ì„ ì €ì¥ (ë¸Œë¼ìš°ì €ì— ê¸°ì–µ)';btn.classList.remove('saved');},2000);
  recalcAll();
}

// â”€â”€ ë™ê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function flashInput(id){
  const el=document.getElementById(id);if(!el)return;
  el.classList.remove('updated');void el.offsetWidth;el.classList.add('updated');
  setTimeout(()=>el.classList.remove('updated'),700);
}

function saveUrlAndSync(){
  const url=document.getElementById('sheets-url').value.trim();
  if(url) localStorage.setItem('sb_sheets_url',url);
  syncFromSheets();
}

function syncFromSheets(silent=false){
  const url=localStorage.getItem('sb_sheets_url')||document.getElementById('sheets-url')?.value?.trim();
  if(!url){if(!silent){setBadge('idle','âš™ï¸ URL ë¯¸ì„¤ì •');showSyncResult('error','âš™ï¸ íƒ­ì—ì„œ URLì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');}return;}
  setBadge('loading','â³ ë™ê¸°í™” ì¤‘...');

  // JSONP ë°©ì‹ - ëª¨ë°”ì¼ CORS ì™„ì „ ìš°íšŒ
  const callbackName = 'sbSyncCallback_' + Date.now();
  const script = document.createElement('script');
  script.src = url + '?callback=' + callbackName;

  const timer = setTimeout(()=>{
    cleanup();
    setBadge('error','âŒ ë™ê¸°í™” ì‹¤íŒ¨');
    if(!silent) showSyncResult('error','âŒ íƒ€ì„ì•„ì›ƒ: Apps Script ì‘ë‹µ ì—†ìŒ');
    else document.getElementById('last-sync').textContent='ë§ˆì§€ë§‰ ë™ê¸°í™”: ì‹¤íŒ¨';
  }, 10000);

  function cleanup(){
    clearTimeout(timer);
    if(script.parentNode) script.parentNode.removeChild(script);
    delete window[callbackName];
  }

  window[callbackName] = function(d){
    cleanup();
    try{
    if(d.prices){
      if(d.prices.p250&&+d.prices.p250>0){document.getElementById('price250').value=d.prices.p250;flashInput('price250');}
      if(d.prices.p500_330&&+d.prices.p500_330>0){document.getElementById('price500').value=d.prices.p500_330;flashInput('price500');}
    }
    if(d.exrate&&+d.exrate>0){document.getElementById('exrate').value=Math.round(d.exrate);flashInput('exrate');}
    if(d.sgdrate&&+d.sgdrate>0){document.getElementById('sgdrate').value=Math.round(d.sgdrate);flashInput('sgdrate');}
    if(d.freight){
      Object.keys(d.freight).forEach(k=>{
        if(FREIGHT[k]){
          if(d.freight[k].airKg)FREIGHT[k].airKg=d.freight[k].airKg;
          if(d.freight[k].fsc!==undefined)FREIGHT[k].fsc=d.freight[k].fsc;
          const a=document.getElementById(`fe-air-${k}`);
          const f=document.getElementById(`fe-fsc-${k}`);
          if(a)a.value=FREIGHT[k].airKg;if(f)f.value=FREIGHT[k].fsc;
        }
      });
    }
    recalcAll();
    const now=new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    setBadge('ok','âœ… ì‹œíŠ¸ ì—°ë™ ì¤‘');
    document.getElementById('last-sync').textContent=`ë§ˆì§€ë§‰ ë™ê¸°í™”: ${now}`;
    if(!silent)showSyncResult('ok',`âœ… ë™ê¸°í™” ì™„ë£Œ (${now})`);
    }catch(err){
      setBadge('error','âŒ ë™ê¸°í™” ì‹¤íŒ¨');
      if(!silent)showSyncResult('error',`âŒ ì˜¤ë¥˜: ${err.message}`);
      else document.getElementById('last-sync').textContent='ë§ˆì§€ë§‰ ë™ê¸°í™”: ì‹¤íŒ¨';
    }
  };

  document.head.appendChild(script);
}

function setBadge(cls,txt){const el=document.getElementById('sync-badge');el.className='sync-badge '+cls;el.textContent=txt;}
function showSyncResult(type,msg){const el=document.getElementById('sync-result');if(!el)return;el.style.display='block';el.className='sync-result '+type;el.textContent=msg;}

// â”€â”€ ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcMargin(offer,spec,fd,p250,p500,exrate,sgdRate){
  const mat    =(spec.priceKey==='250'?p250:p500)*spec.nw;
  const airUnit=fd.airKg+fd.fsc;
  const perBoxFr=(fd.domFreight/spec.cartons)+spec.gw*airUnit;
  const cifKrw =mat+spec.bujajai+perBoxFr;
  const rate   =fd.isSGD?sgdRate:exrate;
  const marginBox=offer-cifKrw/rate;
  const marginPct=offer>0?(marginBox/offer*100):0;
  const totalKrw =marginBox*rate*spec.cartons;
  return{marginBox,marginPct,totalKrw,cifKrw,perBoxFr,sym:fd.isSGD?'S$':'$'};
}

function mCls(m){return m>=1.5?'mpos':m>=0?'mmid':'mneg';}
function fmt(n,d=2){return(n>=0?'+':'')+n.toFixed(d);}
function fmtKrw(n){
  const abs=Math.abs(Math.round(n));
  return(n>=0?'+':'-')+'â‚©'+abs.toLocaleString()+'ì›';
}

// â”€â”€ ë¹Œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildOffers(){
  const panel=document.getElementById('tab-offers');
  panel.innerHTML='';
  Object.entries(FREIGHT).forEach(([key,fd])=>{
    const card=document.createElement('div');
    card.className='country-card';
    card.innerHTML=`
      <div class="country-header">
        <span class="country-flag">${fd.flag}</span>
        <span class="country-name">${fd.name}</span>
        <span class="country-currency ${fd.isSGD?'cur-sgd':'cur-usd'}">${fd.isSGD?'SGD':'USD'}</span>
      </div>`;
    SPECS.forEach((spec,i)=>{
      const def=DEFAULT_PRICES[key][i]??(i===0?22:i===1?28:18);
      const sym=fd.isSGD?'S$':'$';
      const row=document.createElement('div');
      row.className='spec-row';
      row.innerHTML=`
        <div>
          <div class="spec-label">${spec.label}<span class="spec-badge ${spec.cls}">${spec.badge}</span></div>

        </div>
        <div class="price-input-wrap">
          <span class="price-prefix">${sym}</span>
          <input class="price-input" type="number" step="0.1"
            id="offer-${key}-${i}" value="${def}"
            oninput="recalcRow('${key}',${i})">
        </div>
        <div class="margin-display">
          <div class="m-box-val" id="mbox-${key}-${i}">-</div>
          <div class="m-pct"     id="mpct-${key}-${i}">-</div>
          <div class="m-krw-total" id="mkrw-${key}-${i}">-</div>
        </div>
        <button class="log-btn" id="logbtn-${key}-${i}"
          onclick="openLogModal('${key}',${i})" title="ì´ ì˜¤í¼ ê¸°ë¡ ì €ì¥">ğŸ“</button>`;
      card.appendChild(row);
    });
    panel.appendChild(card);
  });
}

function buildFreightEditor(){
  const ed=document.getElementById('freight-editor');
  ed.innerHTML='';
  Object.entries(FREIGHT).forEach(([key,fd])=>{
    const c=document.createElement('div');c.className='freight-card';
    c.innerHTML=`
      <div class="freight-card-header"><span>${fd.flag}</span><span>${fd.name}</span>
        <span style="font-size:9px;color:var(--text2);margin-left:auto">${fd.route}</span></div>
      <div class="freight-fields">
        <div class="freight-field"><label>í•­ê³µìš´ì„ (â‚©/kg)</label>
          <input type="number" id="fe-air-${key}" value="${fd.airKg}" oninput="liveUpdate('${key}')"></div>
        <div class="freight-field"><label>FSC (â‚©/kg)</label>
          <input type="number" id="fe-fsc-${key}" value="${fd.fsc}" oninput="liveUpdate('${key}')"></div>
        <div class="freight-field"><label>êµ­ë‚´ìš´ì„ (â‚©/box)</label>
          <input type="number" id="fe-dom-${key}" value="${fd.domFreight}" oninput="liveUpdate('${key}')"></div>
      </div>`;
    ed.appendChild(c);
  });
}

function liveUpdate(key){
  FREIGHT[key].airKg     =+document.getElementById(`fe-air-${key}`).value||0;
  FREIGHT[key].fsc       =+document.getElementById(`fe-fsc-${key}`).value||0;
  FREIGHT[key].domFreight=+document.getElementById(`fe-dom-${key}`).value||55000;
  SPECS.forEach((_,i)=>recalcRow(key,i));
}

function recalcRow(key,i){
  const p250=+document.getElementById('price250').value||0;
  const p500=+document.getElementById('price500').value||0;
  const ex  =+document.getElementById('exrate').value  ||1400;
  const sgd =+document.getElementById('sgdrate').value ||1137;
  const off =+document.getElementById(`offer-${key}-${i}`)?.value||0;
  const {marginBox,marginPct,totalKrw,cifKrw,perBoxFr,sym}=calcMargin(off,SPECS[i],FREIGHT[key],p250,p500,ex,sgd);
  const cls=mCls(marginBox);
  document.getElementById(`mbox-${key}-${i}`).innerHTML=`<span class="${cls}">${fmt(marginBox)}${sym}</span>`;
  document.getElementById(`mpct-${key}-${i}`).innerHTML=`<span class="${cls}">${fmt(marginPct,1)}%</span>`;
  document.getElementById(`mkrw-${key}-${i}`).textContent=`ì´ ${fmtKrw(totalKrw)} (${SPECS[i].cartons}ë°•ìŠ¤)`;

}

function recalcAll(){Object.keys(FREIGHT).forEach(k=>SPECS.forEach((_,i)=>recalcRow(k,i)));}

function switchTab(name,btn){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('tab-'+name).classList.add('active');
  if(name==='logs'){renderLogs();updateFilterOptions();}
  if(name==='memo'){const el=document.getElementById('free-memo');if(el)el.focus();}
}

// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ë‹«ê¸°
document.getElementById('modal-overlay').addEventListener('click',function(e){
  if(e.target===this)closeModal();
});



// â”€â”€ ììœ  ë©”ëª¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadMemo(){
  const txt=localStorage.getItem('sb_free_memo')||'';
  const el=document.getElementById('free-memo');
  if(el) el.value=txt;
}
let memoTimer=null;
function saveMemo(){
  clearTimeout(memoTimer);
  memoTimer=setTimeout(()=>{
    const txt=document.getElementById('free-memo')?.value||'';
    localStorage.setItem('sb_free_memo',txt);
    const hint=document.getElementById('memo-saved-hint');
    if(hint){hint.textContent='ì €ì¥ë¨ âœ“';setTimeout(()=>hint.textContent='',2000);}
  },600);
}
function clearMemo(){
  if(!confirm('ë©”ëª¨ë¥¼ ì „ë¶€ ì§€ìš¸ê¹Œìš”?'))return;
  localStorage.removeItem('sb_free_memo');
  const el=document.getElementById('free-memo');
  if(el) el.value='';
}

// â”€â”€ ë¹„ë°€ë²ˆí˜¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function checkPw(){
  const val = document.getElementById('pw-input').value;
  if(val === '5678'){
    localStorage.setItem('sb_auth','ok');
    document.getElementById('pw-overlay').classList.add('hidden');
  } else {
    const inp = document.getElementById('pw-input');
    inp.classList.remove('shake');
    void inp.offsetWidth;
    inp.classList.add('shake');
    document.getElementById('pw-error').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”';
    inp.value='';
    setTimeout(()=>document.getElementById('pw-error').textContent='',2000);
  }
}

// ì´ë¯¸ ì¸ì¦ëœ ê²½ìš° ë°”ë¡œ í†µê³¼
if(localStorage.getItem('sb_auth')==='ok'){
  document.getElementById('pw-overlay').classList.add('hidden');
} else {
  setTimeout(()=>document.getElementById('pw-input').focus(),300);
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadStorage();
loadLogs();
loadMemo();
buildOffers();
buildFreightEditor();
recalcAll();

// í•­ìƒ ìµœì‹  URLë¡œ ê°•ì œ ì—…ë°ì´íŠ¸
const HARDCODED_URL='https://script.google.com/macros/s/AKfycbzInpagPLGyvcnEpivUM8ELvnO0XaePqWyfz4WIsdlB-m8d5my6Gwaogty9qWlNOG7JLA/exec';
localStorage.setItem('sb_sheets_url', HARDCODED_URL);
const urlInput=document.getElementById('sheets-url');
if(urlInput) urlInput.value=HARDCODED_URL;
syncFromSheets(true);
</script>
</body>
</html>
